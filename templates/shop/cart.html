{% extends "base.html" %}
{% block title %}–ö–æ—Ä–∑–∏–Ω–∞ ‚Äî WOOM FIT{% endblock %}
{% block topbar_left %}
  <a class="btn btn--ghost" style="padding:8px 10px; border-radius:14px;" href="{% url 'shop:index' %}">‚Üê</a>
{% endblock %}
{% block content %}
  <h2 class="section-title" style="margin-top:6px;">–ö–æ—Ä–∑–∏–Ω–∞</h2>

  <div class="card" style="display:flex; align-items:center; gap:10px;">
    <div style="font-size:22px;">üõ°Ô∏è</div>
    <div style="font-weight:900;">–ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–ø–ª–∞—Ç–∞ –∑–∞–∫–∞–∑–∞</div>
  </div>

  <h2 class="section-title">–ú–æ—è –∫–æ—Ä–∑–∏–Ω–∞</h2>

  {% if items %}
    <div class="card">
      <div class="list">
        {% for it in items %}
          <div class="item">
            <div style="min-width:0;">
              <div class="item__title">{{ it.name }}</div>
              <div class="muted" style="font-weight:900;">{{ it.price_rub }} —Ä—É–±.</div>
            </div>

            <form method="post" action="{% url 'shop:cart_set' it.product_id %}" style="display:flex; gap:8px; align-items:center;">
              {% csrf_token %}
              <button class="btn btn--muted" type="submit" name="qty" value="{{ it.qty|add:'-1' }}">‚àí</button>
              <div style="min-width:18px; text-align:center; font-weight:900;">{{ it.qty }}</div>
              <button class="btn btn--muted" type="submit" name="qty" value="{{ it.qty|add:'1' }}">+</button>
            </form>
          </div>
        {% endfor %}
      </div>

      <div style="height:12px;"></div>

      <div class="item" style="background:#f8fafc;">
        <div class="muted" style="font-weight:900;">–ü—Ä–æ–º–æ–∫–æ–¥/—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç</div>
        <div class="item__chev">‚Ä∫</div>
      </div>

      <div style="height:12px;"></div>

      <div style="display:flex; justify-content:space-between; font-weight:900;">
        <div class="muted">–¢–æ–≤–∞—Ä—ã</div>
        <div>{{ total_rub }} —Ä—É–±.</div>
      </div>
      <div style="display:flex; justify-content:space-between; font-weight:900; margin-top:6px;">
        <div class="muted">–ò—Ç–æ–≥–æ –∫ –æ–ø–ª–∞—Ç–µ</div>
        <div style="font-size:22px;">{{ total_rub }} —Ä—É–±.</div>
      </div>

      <div style="margin-top:14px; display:grid; gap:10px;">
        <form method="post" action="{% url 'orders:checkout' %}" style="display:grid; gap:10px;">
          {% csrf_token %}
          <label style="display:flex; gap:8px; align-items:flex-start; font-weight:800; color:#334155; margin-bottom:8px; font-size:13px;">
            <input type="checkbox" name="agree_offer" required style="width:16px; margin-top:2px;">
            <span>
              –ü—Ä–∏–Ω–∏–º–∞—é <a href="{% url 'core:public_offer' %}" target="_blank" rel="noopener" style="color:var(--pink); font-weight:900;">–ø—É–±–ª–∏—á–Ω—É—é –æ—Ñ–µ—Ä—Ç—É</a> –∏
              <a href="{% url 'core:refund_policy' %}" target="_blank" rel="noopener" style="color:var(--pink); font-weight:900;">—É—Å–ª–æ–≤–∏—è –æ–ø–ª–∞—Ç—ã/–≤–æ–∑–≤—Ä–∞—Ç–∞</a>
            </span>
          </label>
          <label style="display:flex; gap:8px; align-items:flex-start; font-weight:800; color:#334155; margin-bottom:10px; font-size:13px;">
            <input type="checkbox" name="agree_personal_data" required style="width:16px; margin-top:2px;">
            <span>
              –î–∞—é —Å–æ–≥–ª–∞—Å–∏–µ –Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫—É –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
              <a href="{% url 'core:personal_data_consent' %}" target="_blank" rel="noopener" style="color:var(--pink); font-weight:900;">—Ç–µ–∫—Å—Ç —Å–æ–≥–ª–∞—Å–∏—è</a>
            </span>
          </label>
          <button class="btn btn--primary btn--full" type="submit">–û–ø–ª–∞—Ç–∏—Ç—å –∫–∞—Ä—Ç–æ–π</button>
          <button
            class="btn btn--muted btn--full"
            type="submit"
            formaction="{% url 'orders:checkout_wallet' %}"
            {% if not user.is_authenticated %}disabled{% endif %}
            {% if user.is_authenticated and not can_pay_wallet %}disabled{% endif %}
          >
            –û–ø–ª–∞—Ç–∏—Ç—å –∫–æ—à–µ–ª—å–∫–æ–º
            {% if wallet_balance is not None %}
              (–±–∞–ª–∞–Ω—Å {{ wallet_balance }} ‚ÇΩ)
            {% endif %}
          </button>
        </form>

        {% if not user.is_authenticated %}
          <div class="muted" style="text-align:center; font-weight:800;">
            –ß—Ç–æ–±—ã –æ–ø–ª–∞—Ç–∏—Ç—å –∫–æ—à–µ–ª—å–∫–æ–º, –Ω—É–∂–Ω–æ <a href="{% url 'login' %}" style="color:var(--pink); font-weight:900;">–≤–æ–π—Ç–∏</a>.
          </div>
        {% elif not can_pay_wallet and total_rub > 0 %}
          <div class="muted" style="text-align:center; font-weight:800;">
            –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤ –≤ –∫–æ—à–µ–ª—å–∫–µ. –ü–æ–ø–æ–ª–Ω–∏—Ç—å –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑ —Ç–æ–≤–∞—Ä—ã ¬´–ü–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ—à–µ–ª—å–∫–∞¬ª.
          </div>
        {% endif %}
      </div>
    </div>
  {% else %}
    <div class="card" style="text-align:center;">
      <div class="muted" style="font-weight:900;">–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
      <div style="margin-top:12px;">
        <a class="btn btn--primary" href="{% url 'shop:index' %}">–í –º–∞–≥–∞–∑–∏–Ω</a>
      </div>
    </div>
  {% endif %}
{% endblock %}
