{% extends "base.html" %}
{% block title %}–ü—Ä–æ—Ñ–∏–ª—å ‚Äî WOOM FIT{% endblock %}

{% block content %}
{% with w=request.user.wallet %}
  <div class="card" style="margin-bottom:12px;">
    <div style="font-weight:900; font-size:16px;">–ö–æ—à–µ–ª—ë–∫</div>
    <div style="margin-top:6px; font-weight:900; font-size:22px;">
      {{ w.balance }} ‚ÇΩ
    </div>
    <div class="muted" style="margin-top:6px;">
      –ë–∞–ª–∞–Ω—Å –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç –∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
    </div>
  </div>
{% endwith %}

<style>
  .profile-wrap { display:flex; flex-direction:column; gap:14px; }

  .profile-hero{
    border-radius:22px;
    padding:18px 18px;
    background: linear-gradient(90deg, #ff4f8f 0%, #ff7aa7 100%);
    color:#fff;
    display:flex;
    align-items:center;
    justify-content:space-between;
  }
  .profile-hero__left{display:flex; align-items:center; gap:14px;}
  .profile-hero__avatar{
    width:46px; height:46px; border-radius:50%;
    background: rgba(255,255,255,0.25);
    display:flex; align-items:center; justify-content:center;
    font-weight:900;
  }
  .profile-hero__name{font-weight:900; font-size:22px; line-height:1.05;}
  .profile-hero__club{opacity:.9; font-weight:800; margin-top:2px;}
  .profile-hero__arrow{font-size:28px; opacity:.9; padding-left:10px;}

  /* ‚úÖ –°–µ–≥–º–µ–Ω—Ç (—á–∏–Ω–∏—Ç –∫–ª–∏–∫–∏): z-index + pointer-events */
  .segmented{
    background: rgba(255,79,143,0.10);
    border-radius:22px;
    padding:10px;
    display:grid;
    grid-template-columns:1fr 1fr;
    gap:10px;

    position: relative;
    z-index: 10;
    pointer-events: auto;
  }
  .seg-btn{
    border:0;
    border-radius:18px;
    padding:14px 12px;
    font-weight:900;
    font-size:18px;
    cursor:pointer;

    background:#fff;
    color:#111827;
    box-shadow: 0 8px 16px rgba(0,0,0,0.08);

    pointer-events: auto;
  }
  .seg-btn.is-active{
    background:#ff4f8f;
    color:#fff;
    box-shadow: 0 10px 18px rgba(255,79,143,0.28);
  }

  .panel{
    border-radius:22px;
    background:#fff;
    box-shadow: 0 10px 18px rgba(0,0,0,0.06);
    padding:18px;
    min-height:260px;
  }
  .empty{
    display:flex; flex-direction:column;
    align-items:center; justify-content:center;
    gap:12px;
    text-align:center;
    padding:22px 10px;
  }
  .empty .emoji{font-size:40px;}
  .empty .text{font-weight:900; color:#6b7280;}
  .cta{
    display:inline-block;
    padding:12px 18px;
    border-radius:16px;
    background:#ff4f8f;
    color:#fff;
    font-weight:900;
    text-decoration:none;
  }

  .hidden{display:none !important;}
</style>

<div class="profile-wrap">
  <div class="profile-hero">
    <div class="profile-hero__left">
      <div class="profile-hero__avatar">üë§</div>
      <div>
        <div class="profile-hero__name">
          {% if user.is_authenticated %}{{ user.username }}{% else %}–ì–æ—Å—Ç—å{% endif %}
        </div>
        <div class="profile-hero__club">WOOM FIT</div>
      </div>
    </div>
    <div class="profile-hero__arrow">‚Ä∫</div>
  </div>

  <div class="segmented" id="profileTabs">
    <button type="button" class="seg-btn is-active" data-tab="services">–£—Å–ª—É–≥–∏</button>
    <button type="button" class="seg-btn" data-tab="journal">–ñ—É—Ä–Ω–∞–ª</button>
  </div>

  <div class="panel" id="tab-services">
    {% comment %}
      –¢—É—Ç –ø–æ–∑–∂–µ –≤—ã–≤–µ–¥–µ–º —Ä–µ–∞–ª—å–Ω—ã–µ –∞–±–æ–Ω–µ–º–µ–Ω—Ç—ã/—É—Å–ª—É–≥–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
      –ü–æ–∫–∞ ‚Äî –ø—É—Å—Ç–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–∞–∫ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏.
    {% endcomment %}
    <div class="empty">
      <div class="emoji">üèãÔ∏è</div>
      <div class="text">–£ –≤–∞—Å –Ω–µ—Ç –∞–±–æ–Ω–µ–º–µ–Ω—Ç–æ–≤ –∏–ª–∏ —É—Å–ª—É–≥</div>
      <a class="cta" href="/shop/">–ü–µ—Ä–µ–π—Ç–∏ –≤ –º–∞–≥–∞–∑–∏–Ω</a>
    </div>
  </div>

  <div class="panel hidden" id="tab-journal">
    <div class="empty">
      <div class="emoji">üìì</div>
      <div class="text">–ñ—É—Ä–Ω–∞–ª –ø–æ–∫–∞ –ø—É—Å—Ç</div>
    </div>
  </div>
</div>

<script>
(function(){
  const tabs = document.getElementById("profileTabs");
  if (!tabs) return;

  const btns = Array.from(tabs.querySelectorAll("[data-tab]"));
  const panelServices = document.getElementById("tab-services");
  const panelJournal = document.getElementById("tab-journal");

  const key = "woomfit_profile_tab";

  function setTab(name){
    btns.forEach(b => b.classList.toggle("is-active", b.dataset.tab === name));
    if (panelServices) panelServices.classList.toggle("hidden", name !== "services");
    if (panelJournal) panelJournal.classList.toggle("hidden", name !== "journal");
    try { sessionStorage.setItem(key, name); } catch(e) {}
  }

  // restore last tab
  try {
    const saved = sessionStorage.getItem(key);
    if (saved === "journal" || saved === "services") setTab(saved);
  } catch(e) {}

  tabs.addEventListener("click", (e) => {
    const btn = e.target.closest("[data-tab]");
    if (!btn) return;
    e.preventDefault();
    setTab(btn.dataset.tab);
  }, true);
})();
</script>
{% endblock %}
